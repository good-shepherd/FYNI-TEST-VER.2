<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fyni.mapper.eventMapper">

<!-- 	<insert id="eventCreate">
	insert into
	event(event_Title, event_Content, event_WhenBegins, event_WhenEnds, category_ID, location_ID, user_ID)
	values (#{event_Title},#{event_Content},#{event_WhenBegins}, #{event_WhenEnds}, #{category_ID}, #{location_ID}, #{user_ID})
	</insert> -->
	
	<insert id="eventCreate">
	insert into
	event(event_Title, event_Content, event_WhenBegins, event_WhenEnds, category_ID, user_ID, event_Address, event_Location)
	values (#{event_Title}, #{event_Content}, #{event_WhenBegins}, #{event_WhenEnds}, #{category_ID}, #{user_ID}, #{event_Address}, Point(#{event_LocationX}, #{event_LocationY}))
	</insert>
	
	<update id="eventUpdate">
		update event set
		event_Title = #{event_Title},
		event_Content = #{event_Content},
		event_Up = #{event_Up},
		event_Down = #{event_Down},
		event_When = #{event_When},
		event_Picture = #{event_Picture},
		category_ID = #{catetory_ID},
		location_ID = #{location_ID},
		user_ID = #{user_ID},
		event_Hit =
		#{event_Hit}
		where event_ID = #{event_ID}
	</update>
	<select id="eventRead" resultType="com.fyni.domain.EventDTO">
		select event_ID, event_Title, event_Content, event_Up, event_Down, event_WrittenWhen, event_Picture, category_ID, user_ID, event_Hit, event_WhenBegins, event_WhenEnds, event_Address, X(event_Location) as `event_LocationX`, Y(event_Location) as `event_LocationY`
		from event
		where event_ID = #{event_ID};
		update event set event_Hit = event_Hit + 1 where event_ID = #{event_ID};
	</select>
	<select id="eventReadAll" resultType="com.fyni.domain.EventDTO">
		select event_ID, event_Title, event_Content, event_Up, event_Down, event_WrittenWhen, event_Picture, category_ID, user_ID, event_Hit, event_WhenBegins, event_WhenEnds, event_Address, X(event_Location) as `event_LocationX`, Y(event_Location) as `event_LocationY` from event
	</select>
	<select id="eventReadByCategory" resultType="com.fyni.domain.EventDTO">
		select event_ID, event_Title, event_Content, event_Up, event_Down, event_WrittenWhen, event_Picture, category_ID, user_ID, event_Hit, event_WhenBegins, event_WhenEnds, event_Address, X(event_Location) as `event_LocationX`, Y(event_Location) as `event_LocationY` from event
		where category_ID = 
			(select category_ID
	  		 from event_category
			 where category_name = #{category_name})
	</select>
	
	<select id="eventUserOwn" resultType="com.fyni.domain.EventDTO">
		select * from event where user_ID = #{user_ID}
	</select>
	
<!-- 	<select id="eventInCircle"> -->
<!-- 		select -->
<!-- 		*,(6371*acos(cos(radians(#{lat}))*cos(radians(lat))*cos(radians(lon) -->
<!-- 		-radians(#{lon}))+sin(radians(#{lat}))*sin(radians(lat)))) -->
<!-- 		as distance -->
<!-- 		from event -->
<!-- 		having distance &lt;= #{distance} -->
<!-- 		order by distance -->
<!-- 		limit -->
<!-- 		0,300 -->
<!-- 	</select> -->
	<delete id="eventDelete">
		delete from event where event_ID = #{event_ID}
	</delete>
	<update id="eventUpDown">
		update event set
		event_Up = #{event_Up},
		event_Down =
		#{event_Down}
	</update>
	<update id="eventHit">
		update event
		set event_Hit = event_Hit + 1
		where event_ID = #{event_ID}
	</update>
</mapper>